# avm_v2_5

## How to run experiment?

* Checkout from master branch
* Change the variable **experiment_version** defined in terraform script (variables.tf) to match with "version" in step function input
* Make changes in the lambda functions based on the needs of experiment
* Apply **terraform apply** in command line to deploy infrastructure
* Run step function for **base data** if avm_v2_5.knn_base_prod is not updated
* Run step function for **training** to train the models
* Run step function for **batch transform** to evaluate test set

## Training:
* Step function input:
``` 
{
  "job_key": "TrainV0",
  "version": "v0",
  "year_month": 202110,
  "task": "training",
  "bucket": "rnd-avm-v2-dev"
}
```

## Batch transform:
* Step function input:
```
{
  "job_key": "EvalV0",
  "version": "v0",
  "year_month": 202110,
  "task": "batch_transform",
  "training_job_key": "TrainV0",
  "bucket": "rnd-avm-v2-dev",
  "test_data_key": "avm2.5/production/monthly-evaluation/v20220202/df_sales.csv"
}
```

## Base data:
* Step function input:
```
{
  "job_key": "base-2022v0",
  "year_month": 202202,
  "task": "base_data",
  "bucket": "rnd-avm-v2-dev"
}
```

