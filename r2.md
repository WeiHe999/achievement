# avm_v2_5_monthly_retrain_master

## Schedule to run the pipeline

* Step function avm_v2_5_monthly_retrain_master is scheduled to run at 12:00AM on the 28th of each month.
* The scheduled run will reserve 2-month sales as out-of-time test data and then retrain the models.
* The evaluation performance for the newly trained models and the prod models on the same test set is stored to Postgres table **avm_report.retrain_metrics**.

## Manually run the pipeline to retrain the models on the current prod AVM2.5 pipeline

* Checkout from master branch
* Change the variable **experiment_version** defined in terraform script (variables.tf)
* Apply **terraform apply** in command line to deploy infrastructure
* If using the most recent year-month, run the step function avm_v2_5_monthly_retrain_master using the input as below:
``` 
{
  "bucket": "rnd-avm-v2-dev"
}

```
* If using the specified year-month, run the step function avm_v2_5_monthly_retrain_master using the input as below:
``` 
{
  "bucket": "rnd-avm-v2-dev",
  "year_month" : "202101"
}
```

## Manually run the pipeline to retrain the models on a modified AVM2.5 pipeline

* Deploy the modified AVM2.5 pipeline from repo avm_v2_5_rnd, get the **AVM2.5 step function name** and **version**
* Checkout from master branch
* Change the variable **experiment_version** defined in terraform script (variables.tf)
* Apply **terraform apply** in command line to deploy infrastructure
* Run the step function avm_v2_5_monthly_retrain_master using the input as below:
``` 
{
  "bucket": "rnd-avm-v2-dev",
  "year_month" : "202101",
  "step_function": "avm_v2_5_dev_v20220307",
  "version": "v20220307"
}
```

